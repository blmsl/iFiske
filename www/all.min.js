angular.module("ifiske",["ionic","ifiske.controllers","ifiske.directives","ifiske.api","ifiske.db","ifiske.utils","ifiske.update","ifiske.filters","ionic.ion.headerShrink","ngCordova","systemBrowser","ngCordovaSms","ngMessages","ImgCache","leaflet-directive","tabSlideBox"]).constant("$ionicLoadingConfig",{template:"<ion-spinner></ion-spinner>"}).run(["$ionicPlatform","Update","ImgCache","$rootScope",function(e,t,n,o){o.image_endpoint="http://www.ifiske.se",e.ready(function(){window.ionic&&window.ionic.Keyboard&&window.ionic.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&window.StatusBar.styleDefault(),n.$init(),t.update()})}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider","ImgCacheProvider",function(e,t,n,o){o.setOptions({debug:!1,usePersistentCache:!0}),o.manualInit=!0,n.views.swipeBackEnabled(!1),n.views.forwardCache(!0),n.backButton.previousTitleText(!1).text(""),n.tabs.position("bottom");var r="/app/login";window.localStorage.getItem("session")&&(r="/app/home"),t.otherwise(r),e.state("app",{url:"/app",templateUrl:"components/menu/menu.html",controller:"MenuCtrl"}).state("app.login",{url:"/login",templateUrl:"components/login/login.html",controller:"LoginCtrl"}).state("app.recover",{url:"/recover",templateUrl:"components/recover/recover.html",controller:"RecoverCtrl"}).state("app.recover.lostpassword",{url:"/lostpassword",templateUrl:"components/recover/lostpassword.html"}).state("app.recover.resetpassword",{url:"/resetpassword",templateUrl:"components/recover/resetpassword.html"}).state("app.register",{url:"/register",templateUrl:"components/register/register.html",controller:"RegisterCtrl"}).state("app.register.details",{url:"/details",templateUrl:"components/register/register_details.html"}).state("app.register.verify",{url:"/verify",templateUrl:"components/register/register_verify.html"}).state("app.home",{url:"/home",templateUrl:"components/home/home.html",controller:"HomeCtrl"}).state("app.info",{url:"/info",templateUrl:"components/info/info.html"}).state("app.bugs",{url:"/info",templateUrl:"components/menu/report.html"}).state("app.contact",{url:"/contact",templateUrl:"components/contact/contact.html",controller:"ContactCtrl"}).state("app.legal",{url:"/legal",templateUrl:"components/legal/legal.html",controller:"LegalCtrl"}).state("app.about",{url:"/about",templateUrl:"components/about/about.html",controller:"AboutCtrl"}).state("app.userinfo",{url:"/userinfo",controller:"UserCtrl",templateUrl:"components/user/user.html"}).state("app.find_areas",{url:"/find_areas",templateUrl:"components/find_areas/tabs.html",controller:"FindAreasCtrl"}).state("app.find_areas.counties",{url:"/counties",views:{"ionic-tabs":{templateUrl:"components/find_areas/counties.html",controller:"CountiesCtrl"}}}).state("app.find_areas.favorites",{url:"/favorites",views:{"ionic-tabs":{templateUrl:"components/find_areas/favorites.html",controller:"FavoritesCtrl"}}}).state("app.areas",{url:"/areas",params:{id:!1,county:!1,search:""},templateUrl:"components/area_list/area_list.html",controller:"AreasCtrl"}).state("app.cards",{url:"/cards",templateUrl:"components/user_cards/user_cards.html",controller:"UserCardsCtrl"}).state("app.favorites",{url:"/favorites",templateUrl:"components/favorites/favorites.html"}).state("app.fishes",{url:"/fishes",templateUrl:"components/fishes/fishes.html",controller:"FishesCtrl"}).state("app.fishdetail",{url:"/fishdetail/:id",params:{id:!1,fish:!1},templateUrl:"components/fish_detail/fish_detail.html",controller:"FishDetailCtrl"}).state("app.map",{url:"/map",templateUrl:"components/map/map.html",controller:"MapCtrl"}).state("app.techniques",{url:"/techniques",templateUrl:"components/techniques/techniques.html",controller:"TechniquesCtrl"}).state("app.techniquedetail",{url:"/techniquedetail/:id",params:{id:!1,tech:!1},templateUrl:"components/technique_detail/technique_detail.html",controller:"TechniqueDetailCtrl"}).state("app.news",{url:"/news",templateUrl:"components/news/news.html",controller:"NewsCtrl"}).state("app.newsitem",{url:"/news/:id",params:{item:!1,id:!1},templateUrl:"components/news/newsitem.html",controller:"NewsItemCtrl"}).state("app.area",{url:"/area/:id",templateUrl:"components/area/area.html",controller:"AreaCtrl"}).state("app.area.info",{url:"/info",views:{"ionic-tabs":{templateUrl:"components/area/info.html",controller:"AreaInfoCtrl"}}}).state("app.area.map",{url:"/map",views:{"ionic-tabs":{templateUrl:"components/area/map.html",controller:"AreaMapCtrl"}}}).state("app.area.fish",{url:"/fish",views:{"ionic-tabs":{templateUrl:"components/area/fish.html",controller:"AreaFishCtrl"}}}).state("app.area.cards",{url:"/cards",views:{"ionic-tabs":{templateUrl:"components/area/cards.html",controller:"AreaCardsCtrl"}}})}]),angular.module("ifiske.controllers",[]),angular.module("ifiske.directives",[]),angular.module("ifiske.controllers").controller("AboutCtrl",["$scope","$cordovaAppVersion","$ionicPlatform","$ionicModal","Update","Licenses",function(e,t,n,o,r,i){e.version=e.dbDate="Okänt",e.update=r,n.ready(function(){window.cordova&&(t.getVersionNumber().then(function(t){console.log("iFiske version:",t),e.version=t}),t.getVersionCode().then(function(t){e.build=t})),i.get().then(function(t){e.licenses=t.data}),e.alert=function(t){var n=e.$new();n.l=t,o.fromTemplateUrl("components/about/license_modal.html",{scope:n}).then(function(e){n.closeModal=function(){e.hide()},e.show()})}})}]),angular.module("ifiske.controllers").controller("AreaCardsCtrl",["$scope","$ionicModal","localStorage",function(e,t,n){e.$on("$ionicView.beforeEnter",function(){e.smsterms=n.get("sms_terms"),e.predicate="so",t.fromTemplateUrl("components/area/sms_modal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.sms_modal=t}),e.openModal=function(t){e.sms_modal.show(),e.product=t},e.closeModal=function(){e.sms_modal.hide()},e.showTerms=function(){e.showingterms=!e.showingterms},e.showingterms=!1,t.fromTemplateUrl("components/area/rules_modal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.rules_modal=t}),e.openRulesModal=function(t){e.rules_modal.show(),e.product=t},e.closeRulesModal=function(){e.rules_modal.hide()},e.$on("$destroy",function(){e.sms_modal.remove(),e.rules_modal.remove()})})}]),angular.module("ifiske.controllers").controller("AreaCtrl",["$scope","$stateParams","DB",function(e,t,n){e.$on("$ionicView.beforeEnter",function(){console.log("beforeenter area_controller.js")}),n.getArea(t.id).then(function(t){e.area=t,e.$broadcast("ifiske-area"),t.images.then(function(t){e.images=t},function(e){console.error(e)}),n.getOrganization(t.orgid).then(function(t){e.org=t})},function(e){console.log(e)}),n.getAreaFishes(t.id).then(function(t){console.log(t),e.fishes=t},function(e){console.log(e)}),n.getProductsByArea(t.id).then(function(t){e.products=t},function(e){console.log(e)})}]),angular.module("ifiske.controllers").controller("AreaFishCtrl",["$scope",function(e){e.$on("$ionicView.beforeEnter",function(){console.log("beforeenter area_fish_controller.js",e)}),e.sortorder="-amount"}]),angular.module("ifiske.controllers").controller("AreaInfoCtrl",["$scope","$ionicSlideBoxDelegate","sessionData","$ionicPopup","API","DB","$ionicPlatform","$cordovaToast",function(e,t,n,o,r,i,a,s){console.log(e),e.gotoProducts=function(){t.$getByHandle("tabs").slide(1)},e.$on("$ionicView.beforeEnter",function(){}),e.changeFavorite=function(){if(n.token){e.area.favorite=!e.area.favorite;var t;t=e.area.favorite?r.user_add_favorite(e.area.ID).then(function(){return i.addFavorite(e.area.ID)}).then(function(){return a.ready(function(){s.show("Området är nu tillagt i dina favoriter","short","bottom")})}):r.user_remove_favorite(e.area.ID).then(function(){return i.removeFavorite(e.area.ID)}).then(function(){a.ready(function(){s.show("Området är nu borttaget från dina favoriter","short","bottom")})}),t["catch"](function(e){console.log(e)})}else o.alert({title:"Du måste vara inloggad för att kunna markera fiskevatten som favoriter."})}}]),angular.module("ifiske.controllers").controller("AreaMapCtrl",["$scope","DB","leafletEvents","$ionicPlatform","$cordovaGeolocation","$cordovaDeviceOrientation","$timeout","localStorage",function(e,t,n,o){e.map={};var r=function(){e.map.area=e.area,t.getPois(e.area.orgid).then(function(t){e.map.pois=t},function(e){console.error(e)}),t.getPolygons(e.area.orgid).then(function(t){e.map.polygons=t},function(e){console.error(e)})};e.$on("$ionicView.beforeEnter",function(){e.area&&r(),e.$on("ifiske-area",r),e.navigate=function(){o.ready(function(){launchnavigator.navigate([e.navto.lat,e.navto.lng],null,function(){console.log("Opening navigator")},function(e){alert("Navigation failed!",e)})})};var t=["popupopen","popupclose"];e.events={enabled:t},e.$on("leafletDirectiveMarker.popupopen",function(t,n){e.navto=n.model}),e.$on("leafletDirectiveMarker.popupclose",function(){e.navto=null})})}]),angular.module("ifiske.controllers").controller("AreasCtrl",["$scope","$stateParams","$ionicScrollDelegate","DB",function(e,t,n,o){var r=t.search;e.search=r,e.county=t.county||"Sökresultat",o.search("",t.id).then(function(t){e.areas=t},function(e){console.log(e)}),e.clearSearch=function(){e.search=""},e.scrollTop=function(){n.scrollTop()}}]),angular.module("ifiske.controllers").controller("ContactCtrl",["$scope","$state","localStorage",function(e,t,n){e.contactInfo=n.get("contactInfo")}]),angular.module("ifiske.controllers").controller("CountiesCtrl",["$scope","DB","$state","$ionicHistory",function(e,t){var n=function(){t.getCounties().then(function(t){e.counties=t},function(e){console.log(e)})};e.$on("$ionicView.beforeEnter",n)}]),angular.module("ifiske.controllers").controller("FavoritesCtrl",["$scope","DB","$cordovaToast","API","$ionicActionSheet","$ionicPlatform","$ionicHistory",function(e,t,n,o,r,i){var a=function(){t.getUserFavorites().then(function(t){e.favorites=t,console.log(t)})};e.$on("$ionicView.beforeEnter",a);var s=function(r){o.user_remove_favorite(r.ID).then(function(){t.removeFavorite(r.ID),e.favorites.splice(e.favorites.indexOf(r),1),i.ready(function(){window.plugins.toast.hide(),n.show("Området är nu borttaget från dina favoriter","short","bottom")})})};e.notify=function(e){console.log(e),o.user_set_favorite_notification(e.ID,e.not).then(function(){t.setFavoriteNotification(e.ID,e.not),i.ready(function(){window.plugins.toast.hide(),n.show("Notifikationer är "+(e.not?"på":"av"),"short","bottom")})})},e.openPopover=function(e){r.show({buttons:[{text:e.not?"Stäng av notifikationer":"Sätt på notifikationer"}],destructiveText:"Ta bort favorit",destructiveButtonClicked:function(){return s(e),!0},titleText:"Ändra din favorit",cancelText:"Gör inget",buttonClicked:function(){return e.not=!e.not,!0},cancel:function(){}})}}]),angular.module("ifiske.controllers").controller("FindAreasCtrl",["$scope",function(){}]),angular.module("ifiske.controllers").controller("FishDetailCtrl",["$scope","$stateParams","DB",function(e,t,n){e.fish=t.fish,e.fish||n.getFish(t.id).then(function(t){e.fish=t},function(e){console.log(e)})}]),angular.module("ifiske.controllers").controller("FishesCtrl",["$scope","DB",function(e,t){e.sortorder="so",t.getFishes().then(function(t){e.fishes=t,e.default_img=t[0].img},function(e){console.log(e)})}]),angular.module("ifiske.controllers").controller("HomeCtrl",["$scope","$state","$ionicHistory","localStorage","sessionData","Update",function(e,t,n,o,r,i){e.loggedIn=r,e.update=i,o.set("homeHistoryId",n.currentHistoryId()),e.newsTitle=o.get("NEWS"),e.myFunc=function(e){13!==e.keyCode||e.shiftKey||t.go("app.areas",{search:e.srcElement.value})}}]),angular.module("ifiske.controllers").controller("LegalCtrl",["$scope","$state","localStorage",function(e,t,n){e.tos=n.get("tos")}]),angular.module("ifiske.controllers").controller("LoginCtrl",["$scope","$state","Update","$ionicLoading","$ionicHistory","$ionicViewSwitcher",function(e,t,n,o,r,i){e.signIn=function(a){o.show(),n.user_login(a.username.$viewValue,a.password.$viewValue).then(function(){o.hide(),a.$setValidity("loginError",!0),i.nextDirection("forward"),r.nextViewOptions({disableBack:!0,historyRoot:!0}),t.go("app.home")},function(t){o.hide(),a.$setValidity("loginError",!1),e.error=t.response})},e.skip=function(){i.nextDirection("forward"),r.nextViewOptions({disableBack:!0,historyRoot:!0}),t.go("app.home")}}]),angular.module("ifiske.controllers").controller("MapCtrl",["$scope","leafletData","$ionicPlatform","DB","$cordovaGeolocation","$cordovaDeviceOrientation","$timeout","localStorage",function(e,t,n,o){console.log(e),e.map={},e.map.centerOnMe=!0,e.$on("$ionicView.beforeEnter",function(){o.search("").then(function(t){e.map.areas=t})})}]),angular.module("ifiske.controllers").controller("MenuCtrl",["$scope","$state","$ionicViewSwitcher","$ionicPopover","sessionData","Update",function(e,t,n,o,r,i){e.sessionData=r,o.fromTemplateUrl("components/menu/popover.html",{scope:e}).then(function(t){e.popover=t}),e.userinfo=function(){e.popover.hide(),t.go("app.userinfo")},e.logout=function(){e.popover.hide(),i.user_logout(),t.go("app.login")},e.login=function(){e.popover.hide(),n.nextDirection("back"),t.go("app.login")},e.register=function(){e.popover.hide(),t.go("app.register.details")},e.forcedUpdate=function(){i.forcedUpdate()}}]),angular.module("ifiske.controllers").controller("NewsCtrl",["$scope","DB","localStorage",function(e,t,n){e.newsTitle=n.get("NEWS"),t.getNews().then(function(t){e.content=t})}]),angular.module("ifiske.controllers").controller("NewsItemCtrl",["$scope","$stateParams","DB",function(e,t,n){t.item?e.item=t.item:n.getNewsItem(t.id).then(function(t){e.item=t})}]),angular.module("ifiske.controllers").controller("RecoverCtrl",["$scope","$state","$ionicHistory","$ionicPlatform","$ionicLoading","$cordovaToast","API",function(e,t,n,o,r,i,a){"use strict";var s="";e.lostPassword=function(n){r.show(),s=n.user.$viewValue,a.user_lost_password(s).then(function(n){e.info="En återställningskod kommer skickas till dig inom kort, via ",n.mailed&&(e.info+="e-mail",n.texted&&(e.info+=" och ")),n.texted&&(e.info+="SMS"),t.go("^.resetpassword")},function(){n.user.$setValidity("invalidUser",!1)})["finally"](r.hide)},e.resetPassword=function(e){r.show(),a.user_reset_password(s,e.password.$viewValue,e.code.$viewValue).then(function(){o.ready(function(){i.showLongBottom("Ditt lösenord har ändrats")}),t.go("app.login")},function(t){switch(t.error_code){case 16:e.code.$setValidity("invalidCode",!1)}})["finally"](r.hide)}}]),angular.module("ifiske.controllers").controller("RegisterCtrl",["$scope","$state","$ionicLoading","$ionicModal","$ionicScrollDelegate","$ionicPlatform","$cordovaToast","API","localStorage",function(e,t,n,o,r,i,a,s,l){var c;e.checkUsername=function(e){s.user_exists(e.$viewValue).then(function(t){e.$setValidity("nameTaken",!t)})},e.checkEmail=function(e){s.user_exists(null,e.$viewValue).then(function(t){e.$setValidity("emailTaken",!t)})},e.formErrors={},e.register=function(o){n.show(),e.phone=o.phone.$viewValue,c=o.username.$viewValue;var i=o.password.$viewValue,a=o.fullname.$viewValue,l=o.email.$viewValue;s.user_register(c,a,i,l,e.phone).then(function(){n.hide(),e.formErrors={},t.go("^.verify")},function(t){e.formErrors.registrationError=!0,r.scrollTop(!0),8==t.error_code&&o.email.$setValidity("invalidEmail",!1),9==t.error_code&&(e.checkUsername(o.username),e.checkEmail(o.email)),10==t.error_code&&o.phone.$setValidity("invalidPhone",!1),n.hide()})},e.verify=function(o){n.show();var r=o.vercode;s.user_confirm(c,r.$viewValue).then(function(){i.ready(function(){a.showLongBottom("Ditt konto har skapats")}),e.formErrors.validationError=!1,t.go("app.login")},function(t){t.error_code?r.$setValidity("verified",!1):e.formErrors.validationError=!0})["finally"](n.hide())},e.tos=l.get("tos"),o.fromTemplateUrl("components/register/eula.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.eula=t}),e.showEula=function(){e.eula.show()},e.closeEula=function(){e.eula.hide()},e.$on("$destroy",function(){e.eula.remove()})}]),angular.module("ifiske.controllers").controller("TechniqueDetailCtrl",["$scope","$stateParams","DB","$ionicSlideBoxDelegate",function(e,t,n,o){if(e.tech=t.tech,e.images=[],e.tech){var r=e.tech;e.images=[r.img1,r.img2,r.img3].filter(function(e){return!/\/$/.test(e)}),o.update()}else n.getTechnique(t.id).then(function(t){e.images=[t.img1,t.img2,t.img3].filter(function(e){return!/\/$/.test(e)}),o.update(),e.tech=t})}]),angular.module("ifiske.controllers").controller("TechniquesCtrl",["$scope","DB",function(e,t){e.sortorder="so",e.$on("$ionicView.beforeEnter",function(){t.getTechniques().then(function(t){e.techniques=t})})}]),angular.module("ifiske.controllers").controller("UserCtrl",["$scope","DB",function(e,t){t.getUserInfo().then(function(t){e.user=t}),t.getUserNumbers().then(function(t){e.numbers=t})}]),angular.module("ifiske.controllers").controller("UserCardsCtrl",["$scope","$stateParams","DB","Update","$ionicModal","$ionicLoading",function(e,t,n,o,r,i){e.pred="-to",e.endpoint="https://www.ifiske.se";var a=function(){i.show();var t=o.update();console.log(t),t.then(function(e){console.log(e)}),t["finally"](function(){console.log("helloä"),e.now=Date.now(),n.getUserProducts().then(function(t){e.products=t,console.log(e),e.$broadcast("scroll.refreshComplete"),i.hide()},function(t){console.log(t),e.$broadcast("scroll.refreshComplete"),i.hide()})})};e.$on("$ionicView.beforeEnter",a),r.fromTemplateUrl("components/area_cards/rules_modal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.rules_modal=t}),e.openRulesModal=function(t){e.rules_modal.show(),console.log(t),e.product=t},e.closeRulesModal=function(){e.rules_modal.hide()},e.$on("$destroy",function(){e.rules_modal.remove()}),e.update=function(){a()}}]),function(e){"use strict";e.module("ifiske.api",["ifiske.utils"]).provider("API",function(){this.base_url="https://www.ifiske.se/api/v2/api.php",this.$get=["$http","sessionData","localStorage","$q",function(t,n,o,r){var i=this.base_url,a=function(n,o){return r(function(r,a){t({method:"get",url:i,params:e.extend(n,{key:"ox07xh8aaypwvq7a"}),timeout:7e3,cache:o!==!1}).success(function(e){"error"===e.status?a(e.message):e.data?r(e.data.response):a(e)}).error(function(e,t){a(0===t?new Error("Request timeout"):e)})})},s=function(t,o){var r=n.token;return a(e.extend(t,{s:r}),o)};return{get_municipalities:function(){return a({m:"get_municipalities"})},get_counties:function(){return a({m:"get_counties"})},user_exists:function(e,t){var n={m:"user_exists"};return e&&"string"==typeof e&&(n.username=e),t&&"string"==typeof t&&(n.email=t),a(n,!1)},user_register:function(e,t,n,o,r){return a({m:"user_register",username:e,fullname:t,password:n,email:o,phone:r},!1)},user_confirm:function(e,t){return a({m:"user_confirm",username:e,pin:t},!1)},user_info:function(){return s({m:"user_info"})},user_lost_password:function(e){return a({m:"user_lost_password",user_identification:e},!1)},user_reset_password:function(e,t,n){return a({m:"user_reset_password",user_identification:e,password:t,code:n},!1)},user_change_password:function(e,t){return s({m:"user_change_password",old_password:e,new_password:t},!1)},user_login:function(e,t){return a({m:"user_login",username:e,password:t},!1).then(function(e){return n.setToken(e),e})},user_logout:function(){return s({m:"user_logout"},!1).then(function(){n.deleteToken()})},user_products:function(){return s({m:"user_products"},!1)},get_fishes:function(){return a({m:"get_fishes"})},get_techniques:function(){return a({m:"get_techniques"})},get_baits:function(){return a({m:"get_baits"})},get_organizations:function(e){return a({m:"get_organizations",orgid:e})},get_org_modified:function(e){return a({m:"get_org_modified",orgid:e})},get_areas:function(e){return a({m:"get_areas",areaid:e})},get_areas_modified:function(e){return a({m:"get_areas_modified",areaid:e})},get_products:function(e){return a({m:"get_products",areaid:e})},get_rules:function(e){return a({m:"get_rules",ruleid:e})},get_photos:function(e,t){return a({m:"get_photos",orgid:e,areaid:t})},get_map_pois:function(e){return a({m:"get_map_pois",orgid:e})},get_map_poi_types:function(){return a({m:"get_map_poi_types"})},get_map_polygons:function(e){return a({m:"get_map_polygons",orgid:e})},user_get_favorites:function(){return s({m:"user_get_favorites"},!1)},user_add_favorite:function(e){return s({m:"user_add_favorite",areaid:e,flag:0},!1)},user_set_favorite_notification:function(e,t){return t=t?1:0,s({m:"user_set_favorite_notification",areaid:e,flag:t},!1)},user_remove_favorite:function(e){return s({m:"user_remove_favorite",areaid:e},!1)},get_terms_of_service:function(){return a({m:"get_terms_of_service"})},get_contact_info:function(){return a({m:"get_contact_info"})},get_engine_policies:function(){return a({m:"get_engine_policies"})},get_sms_terms:function(){return a({m:"get_sms_terms"})},get_mapbox_api:function(){return a({m:"get_mapbox_apiaccesstoken"})},get_content_menu:function(){return a({m:"get_content_menu"})}}}]})}(window.angular),function(e,t){"use strict";e.module("ifiske.db",[]).provider("DB",function(){this.$get=["$cordovaSQLite","API","$q","$rootScope",function(n,o,r){var i;if(window.sqlitePlugin)i=n.openDB("fiskebasen.db");else{if(!window.openDatabase)return console.log("Not supported on this device, sorry"),t;i=window.openDatabase("fiskebasen.db","1.0","fiskebasen",10485760)}var a={Area:[["ID","int"],["orgid","int"],["t","text"],["kw","text"],["note","text"],["c1","int"],["c2","int"],["c3","int"],["m1","int"],["m2","int"],["m3","int"],["lat","real"],["lng","real"],["zoom","text"],["pnt","int"],["car","int"],["eng","int"],["hcp","int"],["map","text"],["wsc","int"],["mod","int"],["d","text"]],Area_Fish:[["ID","text"],["aid","int"],["fid","int"],["amount","int"],["comment","text"]],Product:[["ID","int"],["t","text"],["t2","text"],["no","text"],["im","text"],["pf","text"],["ai","int"],["ri","int"],["ch","int"],["price","int"],["mod","int"],["so","int"],["hl","text"]],County:[["ID","int"],["s","text"],["t","text"],["d","text"]],Municipality:[["ID","int"],["cID","int"],["name","text"]],Fish:[["ID","int"],["t","text"],["d","text"],["mod","int"],["so","int"],["max","int"],["icon","text"],["img","text"],["in","text"],["geo","text"],["size","text"],["lat","text"],["rec","text"]],Rule:[["ID","int"],["ver","int"],["d","text"],["t","text"]],User_Product:[["ID","int"],["at","int"],["code","int"],["fr","int"],["fullname","text"],["ot","text"],["ref1","int"],["ref2","int"],["t","text"],["to","int"],["pid","int"],["pdf","text"]],User_Info:[["ID","int"],["username","text"],["loggedin","text"],["IP1","text"],["IP2","text"],["name","text"],["email","text"],["created","text"]],User_Number:[["number","text"]],User_Favorite:[["ID","int"],["a","int"],["add","int"],["not","int"],["cnt","int"]],Technique:[["ID","int"],["t","text"],["d","text"],["so","int"],["de","text"],["da","text"],["icon","text"],["img1","text"],["img2","text"],["img3","text"],["youtube","text"]],Organization:[["ID","int"],["t","text"],["d","text"],["cp","text"],["url","text"],["co","int"],["mod","int"],["vat","int"],["dp","int"],["fva","int"],["org","int"],["ml","int"]],Poi:[["ID","int"],["orgid","int"],["type","int"],["price","int"],["t","text"],["d","text"],["la","real"],["lo","real"]],Poi_Type:[["ID","int"],["t","text"],["icon","text"]],Polygon:[["ID","int"],["orgid","int"],["t","text"],["c","text"],["ver","int"],["mod","int"],["poly","text"]],News:[["ID","int"],["t","text"],["text","text"],["img","text"],["icon","text"]]},s=function(t){for(var n=[],o=0;o<t.rows.length;++o)n.push(e.copy(t.rows.item(o)));return n};return{populateTable:function(e,t){return r(function(n,o){i.transaction(function(n){n.executeSql("DELETE FROM "+e+";");for(var o in t){for(var r=t[o],i=[],s=0;s<a[e].length;++s)i.push(r[a[e][s][0]]);var l=["INSERT INTO",e,"VALUES(?",",?".repeat(i.length-1),")"].join(" ");n.executeSql(l,i)}},o,n)})},cleanTable:function(e){return r(function(t,n){i.transaction(function(t){t.executeSql("DELETE FROM "+e+";")},n,t)})},clean:function(){return r(function(e,t){i.transaction(function(e){for(var t in a)e.executeSql("DROP TABLE IF EXISTS "+t+";")},t,e)}).then(function(){console.log("Removed all tables")})},init:function(){return r(function(e,t){i.transaction(function(e){for(var t in a){for(var n=a[t],o=[],r=0;r<n.length;++r)o.push('"'+n[r][0]+'" '+n[r][1]);o=o.join(", ");var i=["CREATE TABLE IF NOT EXISTS",t,"(",o,", PRIMARY KEY(",'"'+n[0][0]+'"',"));"].join(" ");e.executeSql(i)}},t,e)})},getArea:function(e){return r(function(t,r){n.execute(i,["SELECT Area.*,","CASE WHEN User_Favorite.ID IS NULL THEN 0 ELSE 1 END as favorite","FROM Area","LEFT JOIN User_Favorite ON User_Favorite.a = Area.ID","WHERE Area.ID = ?"].join(" "),Array.isArray(e)?e:[e]).then(function(e){console.log(e);var n=s(e)[0];n.images=o.get_photos(n.orgid),t(n)},r)})},getAreaFishes:function(e){return r(function(t,o){n.execute(i,["SELECT *","FROM Area_Fish","JOIN Fish ON Area_Fish.fid = Fish.ID","WHERE Area_Fish.aid = ?"].join(" "),[e]).then(function(e){t(s(e))},o)})},search:function(e,t){return r(function(o,r){n.execute(i,["SELECT Area.*,","CASE WHEN User_Favorite.ID IS NULL THEN 0 ELSE 1 END as favorite","FROM Area","LEFT JOIN User_Favorite ON User_Favorite.a = Area.ID","WHERE t LIKE ?",t?"AND ? IN (c1,c2,c3)":"","ORDER BY t"].join(" "),t?["%"+e+"%",t]:["%"+e+"%"]).then(function(e){o(s(e))},r)})},getProduct:function(e){return r(function(t,o){n.execute(i,["SELECT DISTINCT Product.*,","Rule.t as rule_t,","Rule.ver as rule_ver,","Rule.d as rule_d","FROM Product","JOIN Rule ON Rule.ID = Product.ri","WHERE ID = ?","ORDER BY so"].join(" "),[e]).then(function(e){t(s(e))},o)})},getProductsByArea:function(e){return r(function(t,o){n.execute(i,["SELECT DISTINCT Product.*,","Rule.t as rule_t,","Rule.ver as rule_ver,","Rule.d as rule_d","FROM Product","JOIN Rule ON Rule.ID = Product.ri","WHERE ai = ?","ORDER BY so"].join(" "),[e]).then(function(e){t(s(e))},o)})},getCounties:function(){return r(function(e,t){n.execute(i,["SELECT DISTINCT County.*","FROM County","JOIN Area ON Area.c1 = County.ID","ORDER BY County.t"].join(" ")).then(function(t){e(s(t))},t)})},getUserProducts:function(){return r(function(e,t){n.execute(i,["SELECT User_Product.*,","Rule.t as rule_t,","Rule.ver as rule_ver,","Rule.d as rule_d","FROM User_Product","LEFT JOIN Product ON Product.ID = User_Product.pid","LEFT JOIN Rule ON Rule.ID = Product.ri"].join(" ")).then(function(t){e(s(t))},t)})},getFishes:function(){return r(function(e,t){n.execute(i,["SELECT * FROM Fish"].join(" ")).then(function(t){e(s(t))},t)})},getFish:function(e){return r(function(t,o){n.execute(i,["SELECT * FROM Fish","WHERE id = ?"].join(" "),[e]).then(function(e){t(s(e)[0])},o)})},getTechniques:function(){return r(function(e,t){n.execute(i,["SELECT * FROM Technique"].join(" ")).then(function(t){e(s(t))},t)})},getTechnique:function(e){return r(function(t,o){n.execute(i,["SELECT * FROM Technique","WHERE ID = ?"].join(" "),[e]).then(function(e){t(s(e)[0])},o)})},getOrganization:function(e){return r(function(t,o){n.execute(i,["SELECT * FROM Organization","WHERE ID = ?"].join(" "),[e]).then(function(e){t(s(e)[0])},o)})},getUserInfo:function(){return r(function(e,t){n.execute(i,["SELECT *","FROM User_Info"].join(" ")).then(function(t){e(s(t)[0])},t)})},getUserNumbers:function(){return r(function(e,t){n.execute(i,["SELECT *","FROM User_Number"].join(" ")).then(function(t){e(s(t))},t)})},getUserFavorites:function(){return r(function(e,t){n.execute(i,["SELECT *","FROM User_Favorite","JOIN Area ON User_Favorite.a = Area.ID"].join(" ")).then(function(t){e(s(t))},t)})},removeFavorite:function(e){return r(function(t,o){n.execute(i,["DELETE FROM User_Favorite","WHERE a = ?"].join(" "),[e]).then(function(e){t(e)},o)})},addFavorite:function(e){return r(function(t,o){n.execute(i,["INSERT INTO User_Favorite",'(a, "not") VALUES (?, 0)'].join(" "),[e]).then(function(e){t(e)},o)})},setFavoriteNotification:function(e,t){return r(function(o,r){n.execute(i,["UPDATE User_Favorite",'SET "not" = ? WHERE a = ?'].join(" "),[t,e]).then(function(e){o(e)},r)})},getPois:function(e){return r(function(t,o){n.execute(i,["SELECT *","FROM Poi","WHERE orgid = ?"].join(" "),[e]).then(function(e){t(s(e))},o)})},getPoiTypes:function(){return r(function(e,t){n.execute(i,["SELECT *","FROM Poi_Type"].join(" ")).then(function(t){e(s(t))},t)})},getPolygons:function(e){return r(function(t,o){n.execute(i,["SELECT *","FROM Polygon","WHERE orgid = ?"].join(" "),[e]).then(function(e){t(s(e))},o)})},getNews:function(){return r(function(e,t){n.execute(i,["SELECT *","FROM News"].join(" ")).then(function(t){e(s(t))},t)})},getNewsItem:function(e){return r(function(t,o){n.execute(i,["SELECT *","FROM News","WHERE ID = ?"].join(" "),[e]).then(function(e){t(s(e)[0])},o)})}}}]})}(window.angular),angular.module("ifiske.filters",[]).filter("onebr",function(){return function(e){return e.replace(/(<br>\s*)+/g,"<br>")}}).filter("nobrs",function(){return function(e){return e.replace(/(<br(\s*\/)*>)+/g,"")}}).filter("cleantables",function(){return function(e){return e=e.replace(/(<\/?table>)+/g,""),e=e.replace(/(<\/?tr>)+/g,""),e=e.replace(/(<\/?th>)+/g,""),e=e.replace(/(<(\/?)td.*?>)+?/g,"<$2p>"),e=e.replace(/<p>\s*<\/p>/g,"")}}),function(e){"use strict";e.module("ifiske.update",["ifiske.api","ifiske.db","ifiske.utils"]).provider("Update",function(){this.$get=["API","DB","localStorage","$q","$ionicLoading","sessionData",function(e,t,n,o,r,i){var a="last_update",s={auth:[{endpoint:"user_products",table:"User_Product"},{endpoint:"user_get_favorites",table:"User_Favorite"},{endpoint:"user_info",table:["User_Info","User_Number"],f:function(e){for(var n=e.numbers,r=[],i=0;i<n.length;++i)r.push({number:n[i]});return o.all([t.populateTable("User_Info",[e]).then(function(){return"User_Info"},function(t){return console.log(e),console.log(t),o.reject(t)}),t.populateTable("User_Number",r).then(function(){return"User_Numbers"},function(e){return console.log(e),o.reject(e)})])}}],timed:[{endpoint:"get_areas",f:function(e){var n=[];for(var r in e){var i=e[r].fish;for(var a in i)n.push({ID:r+"_"+a,fid:a,aid:r,amount:i[a][0],comment:i[a][1]})}return o.all([t.populateTable("Area",e),t.populateTable("Area_Fish",n)]).then(function(){return"Area"},function(e){return console.warn(e),o.reject(e)})}},{endpoint:"get_products",table:"Product"},{endpoint:"get_counties",table:"County"},{endpoint:"get_municipalities",table:"Municipality"},{endpoint:"get_fishes",table:"Fish"},{endpoint:"get_rules",table:"Rule"},{endpoint:"get_techniques",table:"Technique"},{endpoint:"get_organizations",table:"Organization"},{endpoint:"get_map_pois",table:"Poi"},{endpoint:"get_map_poi_types",table:"Poi_Type"},{endpoint:"get_map_polygons",table:"Polygon"}],always:[{endpoint:"get_content_menu",f:function(e){return n.set("NEWS",e.title),t.populateTable("News",e.contents).then(function(){return"News"},function(e){return console.warn(e),o.reject(e)})}},{endpoint:"get_terms_of_service",storage_name:"tos"},{endpoint:"get_sms_terms",storage_name:"sms_terms"},{endpoint:"get_contact_info",storage_name:"contactInfo"},{endpoint:"get_mapbox_api",storage_name:"mapbox_api"}]},l=function(e){var t=n.get(a),o=6048e5;return e-t>o},c=function(r){console.log(r);var i,a=e[r.endpoint]();return"function"==typeof r.f?i=r.f:r.table?i=function(e){return t.populateTable(r.table,e).then(function(){return r.table},function(e){return console.warn(e),o.reject(e)})}:r.storage_name&&(i=function(e){return n.set(r.storage_name,e)}),i?a.then(i):void console.error("NO ACTION!")},u=function(){for(var e=[],n=0;n<s.auth.length;++n)if(Array.isArray(s.auth[n].table))for(var r=0;r<s.auth[n].table.length;++r)e.push(t.cleanTable(s.auth[n].table[r]));else e.push(t.cleanTable(s.auth[n].table));return o.all(e).then(function(){console.log("Removed user info from database")},function(e){console.log("Could not remove user data from database!",e)})},f=function(p){return r.show(),o(function(m,d){var g=[],h=Date.now(),v=p||l(h);
t.init().then(function(){console.log("Initialized DB system");for(var l=0;l<s.always.length;++l)g.push(c(s.always[l]));if(i.token)for(l=0;l<s.auth.length;++l)g.push(c(s.auth[l]));if(v)for(l=0;l<s.timed.length;++l)g.push(c(s.timed[l]));o.all(g).then(function(e){console.log("Populated:",e),v&&n.set(a,h),m("Pass")},function(n){return 7!==n.error_code?(console.warn("Got an error, recreate all tables:",n),t.clean().then(f)):(u(),e.user_logout(),d("auth failure"),void 0)})["finally"](function(){r.hide()})})})};return{update:function(){return f()},forcedUpdate:function(){return f(!0)},user_logout:function(){return u(),e.user_logout()},user_login:function(t,n){return e.user_login(t,n).then(function(){f()})},last_update:function(){return n.get(a)}}}]})}(window.angular),angular.module("ifiske.utils",[]).factory("localStorage",["$window",function(e){return{set:function(t,n){e.localStorage.setItem(t,n)},get:function(t){return e.localStorage.getItem(t)},remove:function(t){e.localStorage.removeItem(t)}}}]).service("sessionData",["localStorage",function(e){this.token=e.get("session"),this.setToken=function(t){e.set("session",t),this.token=t,console.log("token set")},this.deleteToken=function(){e.remove("session"),this.token=null,console.log("token unset")}}]).factory("Licenses",["$http",function(e){return{get:function(){return e.get("static/licenses.json")}}}]),angular.module("ngCordovaSms",[]).directive("ngCordovaSms",["$cordovaSms","$ionicPopup",function(e,t){"use strict";return{restrict:"A",link:function(n,o,r){o.on("click",function(n){n.preventDefault(),t.prompt({title:"Skriv in ditt namn",inputType:"text"}).then(function(t){var n="FISKA "+r.ngCordovaSms+" "+t;e.send("72456",n,"INTENT",function(){console.log("succuess")},function(e){console.log(e)})})})}}}]),angular.module("ifiske.directives").directive("ifiskeInput",function(){return{restrict:"E",transclude:!0,scope:{name:"@",id:"@",label:"@",placeholder:"@",type:"@",ngPattern:"@",ngModel:"=?"},templateUrl:"directives/input_field/ifiske_input.html",controller:function(e){e.id=e.id||e.name,e.type=e.type||"text"}}}),angular.module("ifiske.directives",[]).directive("ifiskeMap",function(){return{restrict:"E",transclude:!1,templateUrl:"directives/map/map.html",link:function(e,t,n,o){console.debug(e,o)},scope:{mapData:"="},controller:["$scope","$timeout","localStorage","DB","$q",function(e,t,n,o,r){var i="http://api.tiles.mapbox.com/v4/{maptype}/{z}/{x}/{y}@2x.png?access_token={apikey}",a=n.get("mapbox_api"),s=new L.control.locate({follow:!1,position:"bottomright",keepCurrentZoomLevel:!1,stopFollowingOnDrag:!0,remainActive:!0,onLocationError:function(e){console.error(e),t(function(){s.start()})},onLocationOutsideMapBounds:function(e){console.log(e)},locateOptions:{maxZoom:14},icon:"icon ion-android-locate"}),l={showOnSelector:!1,disableClusteringAtZoom:9,chunkedLoading:!0,showCoverageOnHover:!1,removeOutsideVisibleBounds:!0};angular.extend(e,{map:{paths:{},markers:{},layers:{baselayers:{outdoors:{name:"Utomhus",type:"xyz",url:i,layerOptions:{maptype:"mapbox.outdoors",apikey:a}},satellite:{name:"Satellit",type:"xyz",url:i,layerOptions:{maptype:"mapbox.satellite",apikey:a}}},overlays:{areas:{name:"Fiskeområden",type:"markercluster",visible:!0,layerParams:l},pois:{name:"Pois",type:"markercluster",visible:!0,layerParams:l}}},center:{lat:62,lng:15,zoom:9},controls:{custom:[s]}}});var c,u=function(t){return function(){var n=e.$new();return n.area=t,console.log(t),n}},f=function(){return c?r.when(c):o.getPoiTypes().then(function(e){c={};for(var t=0;t<e.length;++t){var n=e[t];c[n.ID]={iconUrl:"http://www.ifiske.se"+n.icon,iconAnchor:[16,37],popupAnchor:[0,-35]}}})},p=function(t){for(var n=0;n<t.length;++n){var o=t[n];e.map.markers["area_"+n]={layer:"areas",lat:o.lat,lng:o.lng,getMessageScope:u(o),message:'<a ui-sref="app.area.info({id: area.ID })" ng-bind="area.t"></a>',icon:{type:"awesomeMarker",icon:o.favorite?"star":"",markerColor:o.wsc?o.favorite?"orange":"blue":"lightgray",prefix:"ion"}}}},m=function(t){f().then(function(){for(var n=0;n<t.length;++n){var o=t[n];e.map.markers["poi_"+n]={layer:"pois",lat:o.la,lng:o.lo,icon:c[o.type],message:"<h4>"+o.t+"</h4><p>"+o.d+"</p>",popupOptions:{maxWidth:window.innerWidth-50}}}})},d=function(t){e.map.paths=t.map(function(e){return{latlngs:JSON.parse("["+e.poly+"]"),color:e.c,weight:2,opacity:.5,fillColor:e.c,type:"polygon"}})},g=function(t){e.map.markers.area={layer:"pois",lat:t.lat,lng:t.lng,message:t.t},e.map.center={lat:t.lat,lng:t.lng,zoom:Number(t.zoom)?Number(t.zoom):9}};e.$watch("mapData",function(t){t.centerOnMe&&(e.map.center.autoDiscover=!0),t.areas&&p(t.areas),t.pois&&m(t.pois),t.polygons&&d(t.polygons),t.area&&g(t.area)},!0)}]}}),angular.module("systemBrowser",[]).directive("systemBrowser",["$cordovaInAppBrowser",function(e){"use strict";return{restrict:"A",link:function(t,n){n.on("click",function(t){e.open(n[0].href,"_system"),t.preventDefault()})}}}]).directive("globalSystemBrowser",["$cordovaInAppBrowser",function(e){"use strict";return{restrict:"A",link:function(t,n){n.on("click",function(t){t.target.href&&t.target.host!==window.location.host&&(e.open(t.target.href,"_system"),t.preventDefault())})}}}]),angular.module("ifiske.directives",[]).directive("hipTabs",function(){return{scope:!0,restrict:"E",transclude:!0,templateUrl:"directives/tabs/tabs.html",link:function(e){console.log(e)},controller:["$scope","$ionicHistory","$state","$ionicViewSwitcher",function(e,t,n,o){this.scope=e,e["goto"]=function(e){t.viewHistory().currentView=t.viewHistory().backView,o.nextTransition("none"),n.go(e,null,{location:"replace"})}}]}}).directive("hipTab",function(){return{scope:{icon:"@",name:"@",viewName:"@"},restrict:"E",require:"^hipTabs",replace:!0,templateUrl:"directives/tabs/tab.html",link:function(e,t,n,o){console.log(e),e["goto"]=o.scope["goto"]}}});